# Prompt Counter（個人向け・シンプル版）

ChatGPT / Claude / Gemini / Cursor に打った **プロンプト送信イベント**を個別にローカルで記録し、可視化する Chrome 拡張（MVP）です。各送信を最小単位として記録します（PK: UUID v4）。

- ✅ ローカル完結（外部サーバ不要）
- ✅ プロンプト本文は保存しない（回数と時刻のみ）※将来的に本文・返信文保存機能を追加可能な設計
- ✅ まず動く最小機能にフォーカス

---

## 目的
- ツール別の利用回数を “見える化” して習慣化・偏りを把握する
- プライバシーを守りつつ、導入を軽くする

---

## 対象ツール（MVP）
### Web UI 自動カウント
- ChatGPT（chatgpt.com）
- Claude（claude.ai）
- Gemini（aistudio.google.com 等）

### Cursor（MVPは手動カウント）
- Cursor はデスクトップアプリのため、拡張ポップアップの `+1` ボタン or ショートカットで記録

---

## 主要機能（MVP）
- 送信イベント検知（クリック / Enter送信）
- イベント保存（ローカル、送信単位で個別記録）
- ダッシュボード表示（表示時に動的集計：今日 / 7日推移 / ツール別内訳）
- CSVエクスポート（送信イベント単位）
- データ削除（全削除）

---

## プライバシー方針（要点）
- **入力本文は取得・保存しません**
- **外部へ送信しません（ローカルのみ）**
- 保存するのは各送信イベント単位：`id (UUID v4, PK) / timestamp (YYYY-MM-DD hh:mm:ss) / tool / source(webui/manual)` のみ

詳細は `PRIVACY.md` を参照。

---

## セットアップ・ビルド手順

### 1. 依存関係のインストール
```bash
npm install
```

### 2. ビルド
```bash
npm run build
```

### 3. Chrome拡張として読み込む
1. Chromeで `chrome://extensions/` を開く
2. 「デベロッパーモード」を有効化
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. `dist/` ディレクトリを選択

### 4. 開発モード（watch）
```bash
npm run dev
```
ファイル変更時に自動でビルドされます。

## ファイル一覧
- `DESIGN.md`：設計書（要件・アーキ・データ・画面・実装詳細）
- `PRIVACY.md`：プライバシーポリシー（個人向け）
- `SPEC.md`：計測仕様（イベント検知 / デデュープ / 保存項目）
- `TEST_PLAN.md`：テスト観点
- `CHANGELOG.md`：変更履歴テンプレ
- `REVIEW.md`：設計書レビュー結果（不足情報リスト）

---

## 今後（次フェーズ案）
- セッション化（プロンプト間隔で集中時間の推定）
- 目標設定（週100回など）
- Cursor 自動計測（ただし環境依存が増えるため慎重に）
- プロンプト本文・返信文の保存機能（オプション機能として、ユーザー選択で有効化可能）

---

# 非エンジニア向け：どういう仕組みで動いているのか？

この拡張機能は、ChatGPT、Claude、Gemini などのAIツールにプロンプトを送信した回数を自動で記録し、統計を表示するツールです。以下、仕組みを簡単に説明します。

## 全体像

この拡張機能は、**4つの主要なパーツ**で構成されています。

### 1. **監視役（Content Script）**
- 各AIツールのページ（ChatGPT、Claude、Geminiなど）に常駐しています
- 送信ボタンのクリックや Enter キーを押したタイミングを検知します
- 検知すると「プロンプトを送信したよ」という信号を送ります

### 2. **処理役（Background Service Worker）**
- 監視役から送られてきた信号を受け取ります
- 重複チェックを行います（2秒以内に同じイベントが来た場合は、1回として記録）
- データを保存します（ブラウザのローカルストレージに保存）

### 3. **表示役（Popup）**
- 拡張機能のアイコンをクリックすると表示される小さなウィンドウです
- 今日の送信回数を表示します
- Cursor の手動カウントボタンがあります

### 4. **統計画面（Dashboard）**
- 詳細な統計を表示する専用のページです
- 今日の合計、7日間の合計
- 7日間の推移グラフ（折れ線グラフ）
- ツール別の内訳グラフ（棒グラフ）
- CSVエクスポート、データ削除機能

## 動作の流れ（具体例）

### ケース1: ChatGPTでプロンプトを送信した場合

```
1. ユーザーがChatGPTのページで「こんにちは」と入力してEnterキーを押す
   ↓
2. 監視役（Content Script）が「Enterキーが押された！」と検知
   ↓
3. 監視役が処理役（Background）に「プロンプト送信イベントが発生しました」と伝える
   ↓
4. 処理役が重複チェック（2秒以内に同じイベントがないか確認）
   ↓
5. 問題なければ、以下の情報を保存：
   - ID（ユニークな番号）
   - 日時（2024-01-15 14:30:25 のような形式）
   - ツール名（chatgpt）
   - 検知方法（webui = 自動検知）
   ↓
6. 保存完了！
```

### ケース2: Cursorで手動カウントした場合

```
1. ユーザーが拡張機能のアイコンをクリック
   ↓
2. Popupが表示され、「+1 (Cursor)」ボタンが表示される
   ↓
3. ユーザーがボタンをクリック
   ↓
4. Popupが処理役に「手動カウントイベントが発生しました」と伝える
   ↓
5. 処理役が以下の情報を保存：
   - ID（ユニークな番号）
   - 日時（現在時刻）
   - ツール名（cursor）
   - 検知方法（manual = 手動）
   ↓
6. 保存完了！Popupの「今日のカウント」が自動で更新される
```

## データの保存場所と形式

- **保存場所**: ブラウザのローカルストレージ（あなたのパソコンの中だけに保存されます）
- **外部送信**: 一切しません（インターネットには送信されません）
- **保存内容**: プロンプト本文は保存しません。送信回数と時刻のみを保存します

保存されるデータの例：
```
ID: abc123-def456-...
日時: 2024-01-15 14:30:25
ツール: chatgpt
検知方法: webui
```

## 重複防止の仕組み

同じ送信が2回カウントされないように、**2秒以内の重複を除外**する仕組みがあります。例えば、Enterキーとボタンクリックが同時に検知されても、1回として記録されます。

## データの表示方法

### Popup（拡張機能のアイコンをクリック）
- 今日の送信回数を表示します
- 5秒ごとに自動更新されます

### Dashboard（統計画面）
- 今日の合計、7日間の合計を表示
- 7日間の推移グラフ（折れ線グラフ）
- ツール別の内訳グラフ（棒グラフ）
- 30秒ごとに自動更新されます

## データの管理機能

### CSVエクスポート
- すべての記録をCSVファイルとしてダウンロードできます
- Excelなどで開いて分析できます

### データ削除
- すべての記録を削除できます
- 確認ダイアログが表示されるので、誤操作を防げます

### 自動クリーンアップ
- 10,000件を超えると自動で古いデータを削除します
- 90日以上前のデータを優先的に削除します

## プライバシーについて

- **プロンプト本文は保存しません**（送信回数と時刻のみ）
- **外部サーバーには送信しません**（すべてローカルに保存）
- あなたのパソコンの中だけで完結します

## まとめ

この拡張機能は、以下のような流れで動作しています：

1. **監視役**が送信を検知
2. **処理役**が重複をチェックして保存
3. **Popup**や**Dashboard**で統計を表示

すべてローカルで完結し、外部にデータを送信することはありません。安心してご利用ください。
